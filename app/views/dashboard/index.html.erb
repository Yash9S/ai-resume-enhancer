<% content_for :title, "Dashboard - AI Resume Parser" %>
<div class="container-fluid px-3 px-md-4 py-3 py-md-4">
  <!-- Welcome Header -->
  <div class="row mb-3 mb-4">
    <div class="col-12">
      <div class="bg-primary text-white shadow-sm" style="padding: 1.5rem 2rem; border-radius: 20px;">
        <h1 class="mb-2 fw-bold" style="font-size: clamp(1.3rem, 3.5vw, 2rem);">Welcome back, <%= current_user.email.split('@').first.capitalize %>!</h1>
        <p class="mb-0 opacity-90" style="font-size: clamp(0.85rem, 2vw, 1rem);">Enhance your career with AI-powered resume analysis</p>
      </div>
    </div>
  </div>

  <!-- Analytics Cards - Single Row with Flexbox -->
  <div class="row mb-3 mb-md-4">
    <div class="col-12">
      <div class="d-flex gap-2 gap-md-3" style="overflow-x: auto; flex-wrap: nowrap;">
        <!-- Total Resumes -->
        <div class="card border-0 bg-primary text-white shadow-sm" style="flex: 1; min-width: 160px;">
          <div class="card-body text-center p-3">
            <i class="fas fa-file-alt mb-2 opacity-75" style="font-size: 1.2rem;"></i>
            <div class="fs-4 fw-bold"><%= @stats[:total_resumes] %></div>
            <div style="font-size: 0.85rem;" class="opacity-75">Total Resumes</div>
          </div>
        </div>

        <!-- AI Processed -->
        <div class="card border-0 bg-success text-white shadow-sm" style="flex: 1; min-width: 160px;">
          <div class="card-body text-center p-3">
            <i class="fas fa-check-circle mb-2 opacity-75" style="font-size: 1.2rem;"></i>
            <div class="fs-4 fw-bold"><%= @stats[:processed_resumes] %></div>
            <div style="font-size: 0.85rem;" class="opacity-75">AI Processed</div>
          </div>
        </div>

        <!-- Job Descriptions -->
        <div class="card border-0 bg-info text-white shadow-sm" style="flex: 1; min-width: 160px;">
          <div class="card-body text-center p-3">
            <i class="fas fa-briefcase mb-2 opacity-75" style="font-size: 1.2rem;"></i>
            <div class="fs-4 fw-bold"><%= @stats[:total_job_descriptions] %></div>
            <div style="font-size: 0.85rem;" class="opacity-75">Job Descriptions</div>
          </div>
        </div>

        <!-- Success Rate -->
        <% processing_rate = @stats[:total_resumes] > 0 ? (@stats[:successful_processings].to_f / @stats[:total_resumes] * 100).round(0) : 0 %>
        <div class="card border-0 bg-warning text-dark shadow-sm" style="flex: 1; min-width: 160px;">
          <div class="card-body text-center p-3">
            <i class="fas fa-chart-line mb-2 opacity-75" style="font-size: 1.2rem;"></i>
            <div class="fs-4 fw-bold"><%= processing_rate %>%</div>
            <div style="font-size: 0.85rem;" class="opacity-75">Success Rate</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row mb-3 mb-md-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm rounded-3">
        <div class="card-header bg-light border-0 py-3 px-3 px-md-4">
          <h5 class="mb-0 fw-bold text-dark" style="font-size: clamp(1rem, 2vw, 1.25rem);">
            <i class="fas fa-rocket text-primary me-2"></i>Quick Actions
          </h5>
        </div>
        <div class="card-body p-2">
          <div class="row g-2 g-md-3">
            <div class="col-6">
              <%= link_to new_resume_path, class: "btn btn-primary w-100 d-flex align-items-center justify-content-center", style: "padding: 0.75rem 1rem; text-decoration: none; font-size: clamp(0.9rem, 1.5vw, 1rem);" do %>
                <i class="fas fa-upload me-2"></i>Upload New Resume
              <% end %>
            </div>
            <div class="col-6">
              <%= link_to new_job_description_path, class: "btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center", style: "padding: 0.75rem 1rem; text-decoration: none; font-size: clamp(0.9rem, 1.5vw, 1rem);" do %>
                <i class="fas fa-briefcase me-2"></i>Add Job Description
              <% end %>
            </div>
            <div class="col-6">
              <%= link_to resumes_path, class: "btn btn-outline-info w-100 d-flex align-items-center justify-content-center", style: "padding: 0.75rem 1rem; text-decoration: none; font-size: clamp(0.9rem, 1.5vw, 1rem);" do %>
                <i class="fas fa-list me-2"></i>View All Resumes
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if @stats[:total_resumes] > 0 %>
    <!-- Processing Stats -->
    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm rounded-3">
          <div class="card-header bg-light border-0 py-3 px-3 px-md-4">
            <h5 class="mb-0 fw-bold text-dark" style="font-size: clamp(1rem, 2vw, 1.25rem);">
              <i class="fas fa-chart-bar text-success me-2"></i>Processing Analytics
            </h5>
          </div>
          <div class="card-body p-3 p-md-4">
            <% 
              total = @stats[:total_resumes]
              completed = @stats[:successful_processings]
              processing = @resumes.where(processing_status: ['pending', 'queued', 'processing']).count rescue 0
              failed = total - completed - processing
            %>
            <div class="row g-2 g-md-3 mb-3 mb-md-4">
              <div class="col-6 col-lg-3">
                <div class="bg-success bg-opacity-10 rounded-3 p-3 text-center">
                  <h4 class="fw-bold text-success mb-2" style="font-size: clamp(1.2rem, 3vw, 1.5rem);"><%= completed %></h4>
                  <div class="text-muted mb-2" style="font-size: clamp(0.75rem, 1.5vw, 0.875rem);">Completed</div>
                  <small class="badge bg-success"><%= total > 0 ? (completed.to_f / total * 100).round(1) : 0 %>%</small>
                </div>
              </div>
              <div class="col-6 col-lg-3">
                <div class="bg-warning bg-opacity-10 rounded-3 p-3 text-center">
                  <h4 class="fw-bold text-warning mb-2" style="font-size: clamp(1.2rem, 3vw, 1.5rem);"><%= processing %></h4>
                  <div class="text-muted mb-2" style="font-size: clamp(0.75rem, 1.5vw, 0.875rem);">Processing</div>
                  <small class="badge bg-warning"><%= total > 0 ? (processing.to_f / total * 100).round(1) : 0 %>%</small>
                </div>
              </div>
              <div class="col-6 col-lg-3">
                <div class="bg-danger bg-opacity-10 rounded-3 p-3 text-center">
                  <h4 class="fw-bold text-danger mb-2" style="font-size: clamp(1.2rem, 3vw, 1.5rem);"><%= failed %></h4>
                  <div class="text-muted mb-2" style="font-size: clamp(0.75rem, 1.5vw, 0.875rem);">Failed</div>
                  <small class="badge bg-danger"><%= total > 0 ? (failed.to_f / total * 100).round(1) : 0 %>%</small>
                </div>
              </div>
              <div class="col-6 col-lg-3">
                <div class="bg-primary bg-opacity-10 rounded-3 p-3 text-center">
                  <h4 class="fw-bold text-primary mb-2" style="font-size: clamp(1.2rem, 3vw, 1.5rem);"><%= total %></h4>
                  <div class="text-muted mb-2" style="font-size: clamp(0.75rem, 1.5vw, 0.875rem);">Total</div>
                  <small class="badge bg-primary">100%</small>
                </div>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-3 mb-md-4">
              <div class="d-flex justify-content-between mb-2 mb-md-3">
                <span class="fw-medium text-muted" style="font-size: clamp(0.85rem, 1.5vw, 0.95rem);">Overall Progress</span>
                <span class="fw-medium text-primary" style="font-size: clamp(0.85rem, 1.5vw, 0.95rem);"><%= total > 0 ? (completed.to_f / total * 100).round(1) : 0 %>% Complete</span>
              </div>
              <div class="progress rounded-pill" style="height: 10px;">
                <div class="progress-bar bg-success" style="width: <%= total > 0 ? (completed.to_f / total * 100) : 0 %>%"></div>
                <div class="progress-bar bg-warning" style="width: <%= total > 0 ? (processing.to_f / total * 100) : 0 %>%"></div>
                <div class="progress-bar bg-danger" style="width: <%= total > 0 ? (failed.to_f / total * 100) : 0 %>%"></div>
              </div>
            </div>

            <div class="text-center" style="font-size: clamp(0.8rem, 1.5vw, 0.9rem);">
              <span class="me-2 me-md-3"><span class="badge bg-success me-1">●</span>Completed</span>
              <span class="me-2 me-md-3"><span class="badge bg-warning me-1">●</span>Processing</span>
              <span><span class="badge bg-danger me-1">●</span>Failed</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <!-- Empty State -->
    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm rounded-3">
          <div class="card-body text-center py-4 py-md-5 px-3">
            <i class="fas fa-rocket mb-3 mb-md-4 text-primary opacity-50" style="font-size: clamp(2rem, 5vw, 3rem);"></i>
            <h3 class="mb-2 mb-md-3" style="font-size: clamp(1.2rem, 3vw, 1.75rem);">Ready to get started?</h3>
            <p class="text-muted mb-3 mb-md-4" style="font-size: clamp(0.9rem, 2vw, 1rem);">Upload your first resume and let our AI help enhance your career prospects!</p>
            <%= link_to "Upload Resume", new_resume_path, class: "btn btn-primary btn-lg", style: "padding: 0.75rem 2rem; font-size: clamp(0.9rem, 2vw, 1rem);" %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
